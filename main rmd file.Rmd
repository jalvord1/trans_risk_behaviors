---
title: "main r file"
author: "Julianna Alvord"
date: "2/13/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### This should remain the same for everyone
```{r}
library(dplyr)
library(mosaic)
library(ggplot2)
library(stats)

#can't upload file because too large
#need to select vars

#vars selected and data filtered in other rmd (data download.Rmd)

filtered_data <- read.csv("Pop Health Data 2016.csv")
```

###Julianna
```{r}
#Starting data analysis 2-14

#Creating new vars------------------------

#Transgender
filtered_data <- filtered_data %>%
  filter(!trnsgndr %in% c(7,9)) %>%
  mutate(transgender = ifelse(trnsgndr == 1, "female", 
                              ifelse(trnsgndr == 2, "male", 
                                     ifelse(trnsgndr == 3, "non-conforming", "Cis"))))

#High HIV risk binary variable 
filtered_data <- filtered_data %>%
  filter(!is.na(hivrisk4)) %>%
  filter(!hivrisk4 %in% c(7, 9)) %>%
  mutate(high_hiv_risk = ifelse(hivrisk4 == 1, 1, 0))

#Race (grouped) 
filtered_data <- filtered_data %>%
  filter(!x.racegr3 == 9) %>%
  mutate(race = ifelse(x.racegr3 == 1, "white", 
                       ifelse(x.racegr3 == 2, "black", 
                              ifelse(x.racegr3 == 3, "other", 
                                     ifelse(x.racegr3 == 4, "multi", "hispanic")))))

#Descriptive Stats-----------------------
tally(filtered_data$transgender)
tally(filtered_data$high_hiv_risk)


#Models-----------------------------------

#Initial Model
logm1 <- glm(high_hiv_risk ~ transgender, data = filtered_data, family = binomial)
summary(logm1)

exp(cbind(OR = coef(logm1)))

#Adding race var
filtered_data$race <- as.factor(filtered_data$race)
filtered_data$race <- relevel(filtered_data$race, ref = "white")

logm2 <- glm(high_hiv_risk ~ transgender + race, data = filtered_data, family = binomial)
summary(logm2)

exp(cbind(OR = coef(logm2)))


#Interaction var (trans:race) 
logm_int <- glm(high_hiv_risk ~ transgender + race + transgender*race, data = filtered_data, family = binomial)
summary(logm_int)

exp(cbind(OR = coef(logm_int)))

#Are the interaction terms compared to transgender:white or cis:white?
```

###Natalie
```{r}
ggplot(aes(x=myass, y=git), data="lithub")
```

###Raegan
```{r}
Starting data analysis 2-14
```

###Cas
```{r}
filtered_data<-filtered_data %>%
  mutate(state = factor(x.state, levels=c(6, 9, 10, 13, 15, 16, 17, 18, 19, 21, 22, 25, 27, 28, 29, 32, 36, 39, 42, 44, 48, 50, 51, 53, 55, 66), labels=c("California", "Connecticut", "Delaware", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kentucky", "Louisiana", "Massachusetts", "Minnesota", "Mississippi", "Missouri", "Nevada", "New York", "Ohio", "Pennsylvania", "Rhode Island", "Texas", "Vermont", "Virginia", "Washington", "Wisconsin", "Guam"))) %>%
  mutate(generalhealth = ifelse(genhlth %in% c(7, 9), NA, genhlth)) %>%
  mutate(physicalhealth = ifelse(physhlth %in% c(77, 99), NA,
         ifelse(physhlth == 88, 0, physhlth))) %>%
  mutate(mentalhealth = ifelse(menthlth %in% c(77, 99), NA,
         ifelse(menthlth == 88, 0, menthlth))) %>%
  mutate(poorhealth = ifelse(poorhlth %in% c(77, 99), NA,
         ifelse(poorhlth == 88, 0, poorhlth))) %>%
  mutate(healthplan = ifelse(hlthpln1 == 1, "Healthcare", 
                       ifelse(hlthpln1 == 2, "No Healthcare", NA))) %>%
  mutate(medicalcost = ifelse(medcost == 1, "Cost Barrier", 
                        ifelse(medcost == 2, "No cost Barrier", NA))) %>%
  mutate(checkup = ifelse(checkup1 == 1, "<1", 
                          ifelse(checkup1 == 2, "1-2", 
                                 ifelse(checkup1 == 3, "2-5",
                                        ifelse(checkup1 == 5, ">5", NA))))) %>%
  mutate(exercise = ifelse(exerany2 == 1, "Exercise", 
                       ifelse(exerany2 == 2, "No Exercise", NA))) %>%
  mutate(sleep = ifelse(sleptim1 %in% c(77, 99), NA, sleptim1)) %>%
  mutate(sexfactor = ifelse(sex == 1, "Male", 
                       ifelse(sex == 2, "Female", "Refused"))) %>%
  mutate(educationbinary = ifelse(educa == 6, "Graduated College or Technical School", 
                                  ifelse(educa == 9, NA, "Did Not Graduate College or Technical School"))) %>%
  mutate(employment = ifelse(employ1 %in% c(1,2), "Paid Work", 
                             ifelse(employ1 %in% c(5,6), "Unpaid Work",
                                    ifelse(employ1 == 9, NA, "Not working")))) %>%
  mutate(numchildren = ifelse(children %in% c(99), NA,
         ifelse(children == 88, 0, children))) %>%
  mutate(income = ifelse(income2 %in% c(77, 99), NA, income2)) %>%
  mutate(income = factor(income, levels = c(1,2,3,4,5,6,7,8), labels = c("<10k", "10k-15k", "15k-20k", "20k-25k", "25k-35k", "35k-50k", "50k-75k", ">75k"))) %>%
  #mutate(weight = ifelse(weight2 %in% c(7777, 9999), NA,
  #                       ifelse(weight2 %in% c(9000:9998), ((weight2-9000)*2.20462), weight2)))
  #something is wrong with the weight transformation
  mutate(hivtest = ifelse(hivtst6 == 1, "Tested for HIV", 
                          ifelse(hivtst6 == 2, "Not Tested for HIV", NA))) %>%
  mutate(doctorvisits = ifelse(drvisits == 77, NA, 
                               ifelse(drvisits == 88, 0, drvisits))) %>%
  mutate(medicationcost = ifelse(medscost == 1, "Cost Barrier", 
                        ifelse(medscost == 2, "No cost Barrier",
                               ifelse(medscost == 3, "No Medication", NA)))) %>%
  mutate(sexualorientation = ifelse(sxorient == 1, "Straight",
                                    ifelse(sxorient == 2, "Lesbian or gay", 
                                           ifelse(sxorient == 3, "Bisexual", 
                                                  ifelse(sxorient == 4, "Other", NA))))) %>%
  mutate(emotionalsupport = ifelse(emtsuprt %in% c(7,9), NA, emtsuprt)) %>%
  mutate(bmi = factor(x.bmi5cat, levels=c(1:4), labels=c("Underweight", "Normal Weight", "Overweight", "Obese"))) %>%
  mutate(racebinary = ifelse(race == "white", "White", "Non-White")) %>%
  mutate(incomebinary = ifelse(income %in% c("<10k", "10k-15k", "15k-20k", "20k-25k"), "Less than $25,000 per year", "Greater than $25,000 per year"))
```




